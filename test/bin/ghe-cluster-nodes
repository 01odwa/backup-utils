#!/usr/bin/env bash
# Usage: ghe-cluster-nodes
# Emulates the remote GitHub ghe-config command. Tests use this
# to assert that the command was executed.
set -e

case "$1" in
  -r|--role)
      # fake change last save timestamp every 1s
      ROLE=$2
      shift
      shift
      ;;
esac

CONFIG="$GHE_REMOTE_DATA_USER_DIR/common/cluster.conf"

hosts=$(git config -f $CONFIG --get-regexp cluster.*.hostname | cut -d ' ' -f2)

for hostname in $hosts; do
  [ -n "$ROLE" ] && [ "$(git config -f $CONFIG cluster.$hostname.$ROLE-server)" != "true" ] && continue
  echo $hostname
done